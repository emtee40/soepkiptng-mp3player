#!/usr/bin/perl

open F, $ARGV[0]
	or die "$ARGV[0]: $!\n";

read F, $buf, 12;
close F;

$buf =~ /^MP\+/
	or die "$ARGV[0]: No Musepack file\n";

$flags = unpack "V", substr($buf, 8);
$freq = (44100, 48000, 37800, 32000)[($flags >> 16) & 3];

if($freq != 44100) {
	open STDOUT, "| resample $freq 44100";
}

exec "mppdec", "--silent", "--raw-le", $ARGV[0], "-";
die "mppdec";
